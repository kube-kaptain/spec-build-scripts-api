# SPDX-License-Identifier: CC-BY-SA-4.0
# Copyright (c) 2025 Kaptain contributors (Fred Cooke)
# Kaptain Build Scripts API Specification
# As-built from buildon-github-actions

$schema: https://github.com/kube-kaptain/spec-scripts-api-schema/releases/download/0.9/spec-scripts-api-schema-0.9.json
$id: https://github.com/kube-kaptain/${ProjectName}/releases/download/${Version}/${ProjectName}-${Version}.yaml

name: ${ProjectName}
version: "${Version}"
source: https://github.com/kube-kaptain/${ProjectName}
latest: https://raw.githubusercontent.com/kube-kaptain/${ProjectName}/main/${ProjectName}.yaml
tagged: https://raw.githubusercontent.com/kube-kaptain/${ProjectName}/${Version}/${ProjectName}.yaml
release: https://github.com/kube-kaptain/${ProjectName}/releases/download/${Version}/${ProjectName}-${Version}.yaml

description: |
  CI-agnostic build scripts for containerised application builds.
  Handles quality checks, versioning, Docker builds, and registry operations.

tool_requirements:
  # Core tools - validated first, used by version checks of later tools
  - name: GNU grep
    binary: grep
    min_version: "2.0"
    version_check: "grep --version | head -1"
    version_pattern: "([0-9]+\\.[0-9]+)"
    notes: Used for pattern matching in version checks

  - name: GNU sed
    binary: sed
    min_version: "4.0"
    version_check: "sed --version | head -1"
    version_pattern: "([0-9]+\\.[0-9]+)"
    notes: Used for text processing

  - name: Git
    binary: git
    min_version: "2.20"
    version_check: "git --version"
    version_pattern: "([0-9]+\\.[0-9]+)"
    homepage: https://git-scm.com
    download: https://git-scm.com/downloads
    notes: Required for version calculation and quality checks

  - name: Mike Farah YQ 4
    binary: yq
    min_version: "4.0"
    max_version: "5.0"
    version_check: "yq --version"
    version_pattern: "([0-9]+\\.[0-9]+)"
    homepage: https://github.com/mikefarah/yq
    download: https://github.com/mikefarah/yq/releases
    notes: Must be mikefarah/yq v4, not Python yq or v3

  - name: Docker CLI
    binary: docker
    min_version: "20.0"
    version_check: "docker --version"
    version_pattern: "([0-9]+\\.[0-9]+)"
    homepage: https://www.docker.com
    download: https://docs.docker.com/get-docker/
    notes: Required for image building and registry operations

  - name: awk
    binary: awk
    min_version: "2"
    max_version: "2"
    version_check: "echo '1.2.3' | awk -F. '{print $2}'"
    version_pattern: "([0-9]+)"
    notes: Functional check disguised as version check - outputs "2" if awk works. POSIX awk only - no gawk extensions.

  - name: Zip 3.0 by Info-Zip
    binary: zip
    min_version: "3.0"
    version_check: "zip --version | head -2 | tail -1"
    version_pattern: "([0-9]+\\.[0-9]+)"
    homepage: https://infozip.sourceforge.net
    notes: Required for manifest packaging

  - name: curl
    binary: curl
    min_version: "7.50"
    version_check: "curl --version | head -1"
    version_pattern: "curl ([0-9]+\\.[0-9]+)"
    homepage: https://curl.se
    notes: Required by cloud login plugins for API calls. Keep usage to basic features.

  - name: jq
    binary: jq
    min_version: "1.5"
    version_check: "jq --version"
    version_pattern: "jq-([0-9]+\\.[0-9]+)"
    homepage: https://jqlang.github.io/jq/
    notes: Required by spec-validate for JSON parsing. Keep usage to basic features.

entrypoints:
  basic-quality-checks:
    description: |
      Validate branch naming conventions, branch quality, merge candidate setup, and commit message quality.
      Designed to run as the first check in every build to fail fast on quality violations and poor practice.
    inputs:
      DEFAULT_BRANCH:
        type: string
        description: The default/release branch name
        default: main

      ADDITIONAL_RELEASE_BRANCHES:
        type: array
        description: Additional branches treated as release branches
        default: []
        separator: ","

      BLOCK_SLASHES:
        type: boolean
        description: Reject branch names containing forward slashes
        default: false
        added_in_version: "0.0"
        deprecated_in_version: "0.1"
        replaced_by: BLOCK_SLASH_CONTAINING_BRANCHES

      BLOCK_SLASH_CONTAINING_BRANCHES:
        type: boolean
        description: Reject branch names containing forward slashes
        default: false
        deprecated_alias: BLOCK_SLASHES
        added_in_version: "0.1"

      BLOCK_DOUBLE_HYPHEN_CONTAINING_BRANCHES:
        type: boolean
        description: Reject branch names containing double hyphens (typo detection)
        default: true

      REQUIRE_CONVENTIONAL_BRANCHES:
        type: boolean
        description: Require conventional branch prefixes (feature/, fix/, etc.)
        default: false

      REQUIRE_CONVENTIONAL_COMMITS:
        type: boolean
        description: Require conventional commit message format
        default: false

      BLOCK_CONVENTIONAL_COMMITS:
        type: boolean
        description: Block conventional commit format (mutually exclusive with require)
        default: false

      TARGET_BRANCH:
        type: string
        description: Target branch for rebase checks
        default: "${DEFAULT_BRANCH}"

      MERGE_CANDIDATE_BRANCH:
        type: string
        description: Source branch being checked
        default: "(current branch)"

      MERGE_CANDIDATE_CREATOR:
        type: string
        description: Username or ID of the merge candidate creator (for bot detection)
        default: ""

      LOG_ERROR_PREFIX:
        type: string
        description: Prefix for error messages (CI integration)
        default: ""

      LOG_ERROR_SUFFIX:
        type: string
        description: Suffix for error messages (CI integration)
        default: ""

    outputs: {}

    exit_codes:
      "0": All quality checks passed
      '1': Unexpected error from tooling
      "2": |
        Bad branch name. Checks:
        - Auto-generated pattern: always-on (branch names in the form creator-patch-N)
        - Slashes: default off (turn on with BLOCK_SLASH_CONTAINING_BRANCHES=true)
        - Double hyphens: default on (turn off with BLOCK_DOUBLE_HYPHEN_CONTAINING_BRANCHES=false)
        - Conventional prefixes: default off (turn on with REQUIRE_CONVENTIONAL_BRANCHES=true)
      "4": |
        Bad commit message. Checks:
        - Web UI auto-generated: always-on ("Update X", "Create X", and "Delete X" prefixes are bad even if hand written)
        - Require conventional format: default off (turn on with REQUIRE_CONVENTIONAL_COMMITS=true)
        - Block conventional format: default off (turn on with BLOCK_CONVENTIONAL_COMMITS=true)
      "8": |
        Bad branch contents. Checks:
        - Merge commit detected: always-on (No matter how they got there, eg back-merge from main, this isn't okay)
        - Not rebased onto target: always-on (If not up to date with respect the target, we cannot guarantee correctness after merge)
      "16": |
        Bad merge candidate setup. Checks:
        - Invalid target branch: always-on (controlled by DEFAULT_BRANCH and ADDITIONAL_RELEASE_BRANCHES)
        - Target branch not found: always-on
      '32': Reserved
      '64': Reserved
      '128': Reserved

    exit_codes_combinable: true

    notes: |
      Exit codes other than 1 are bit flags and are combined before being returned.
      For example, exit code 6 means both bad branch name (2) and bad commit message (4).

  versions-and-naming:
    description: |
      Calculate version numbers and generate naming for Docker images.
      Supports multiple version calculation strategies via plugins.
    inputs:
      DEFAULT_BRANCH:
        type: string
        description: The default/release branch name
        default: main

      ADDITIONAL_RELEASE_BRANCHES:
        type: array
        description: Additional branches treated as release branches
        default: []
        separator: ","

      MAX_VERSION_PARTS:
        type: integer
        description: Maximum version depth (2, 3, or 4 parts)
        default: 3
        min: 2
        max: 4

      TAG_VERSION_CALCULATION_STRATEGY:
        type: string
        description: Strategy plugin for version calculation
        default: git-auto-closest-highest
        allowed_values:
          - git-auto-closest-highest
          - file-pattern-match

      TAG_VERSION_PATTERN_TYPE:
        type: string
        description: Pattern type for file-based version extraction
        default: dockerfile-env-kubectl

      TAG_VERSION_PREFIX_PARTS:
        type: integer
        description: Number of version prefix parts to preserve

      DOCKERFILE_SUB_PATH:
        type: string
        description: Path to Dockerfile directory
        default: ""

      TAG_VERSION_SOURCE_SUB_PATH:
        type: string
        description: Subdirectory containing version source
        default: ""

      TAG_VERSION_SOURCE_FILE_NAME:
        type: string
        description: Filename containing version
        default: ""

      TAG_VERSION_SOURCE_CUSTOM_PATTERN:
        type: string
        description: Custom regex pattern for version extraction
        default: ""

      BUILD_MODE:
        type: string
        description: Build mode that controls release eligibility, and publishing of artifacts (including a git tag)
        default: local
        allowed_values:
          - local
          - build_server
        notes: Defaults to 'local' (safe, no releases). CI pipelines must explicitly set 'build_server' to enable pushing the generated tag and publishing artifacts. Operators with bootstrap or recovery build requirements and write access to necessary repos must configure this deliberately.

      LOG_ERROR_PREFIX:
        type: string
        description: Prefix for error messages
        default: ""

      LOG_ERROR_SUFFIX:
        type: string
        description: Suffix for error messages
        default: ""

    outputs:
      VERSION:
        type: string
        description: Full calculated version (e.g., 1.2.3)

      VERSION_MAJOR:
        type: string
        description: Major version number

      VERSION_MINOR:
        type: string
        description: Minor version number

      VERSION_PATCH:
        type: string
        description: Patch version number

      VERSION_2_PART:
        type: string
        description: Version padded/truncated to 2 parts

      VERSION_3_PART:
        type: string
        description: Version padded/truncated to 3 parts

      VERSION_4_PART:
        type: string
        description: Version padded/truncated to 4 parts

      DOCKER_TAG:
        type: string
        description: Docker tag (version for release, version-PRERELEASE otherwise)

      DOCKER_IMAGE_NAME:
        type: string
        description: Docker image name (prefix/project-name)

      IS_RELEASE:
        type: boolean
        description: Whether this is a release build

      PROJECT_NAME:
        type: string
        description: Repository/project name

    exit_codes:
      "0": Success
      "1": Invalid input (bad BUILD_MODE, strategy not found)
      "42": Infrastructure failure (git operations)

  docker-build-dockerfile:
    description: |
      Build a Docker image from a Dockerfile.
      Handles token substitution, squashing, and label injection.
    inputs:
      DOCKER_TARGET_REGISTRY:
        type: string
        description: Target container registry hostname
        required: true

      DOCKER_TARGET_BASE_PATH:
        type: string
        description: Path between registry and image name
        default: ""

      DOCKERFILE_SUB_PATH:
        type: string
        description: Path to Dockerfile directory
        default: src/docker

      OUTPUT_SUB_PATH:
        type: string
        description: Build output directory
        default: target

      SQUASH:
        type: boolean
        description: Squash image layers
        default: true

      NO_CACHE:
        type: boolean
        description: Disable Docker layer caching
        default: true

      SUBSTITUTION_TOKEN_STYLE:
        type: string
        description: Token substitution syntax style
        default: shell
        allowed_values:
          - shell
          - mustache
          - helm
          - erb
          - github-actions
          - blade
          - stringtemplate
          - ognl
          - t4
          - swift

      TOKEN_NAME_STYLE:
        type: string
        description: Case style for token names
        default: PascalCase
        allowed_values:
          - PascalCase
          - camelCase
          - lower_snake
          - UPPER_SNAKE
          - lower-kebab
          - UPPER-KEBAB
          - lower.dot
          - UPPER.DOT
          - ALL

      TOKEN_NAME_VALIDATION:
        type: string
        description: Token name validation mode
        default: MATCH

      ALLOW_BUILTIN_TOKEN_OVERRIDE:
        type: boolean
        description: Allow overriding built-in tokens
        default: false

      CONFIG_SUB_PATH:
        type: string
        description: Configuration directory path
        default: src/config

      CONFIG_VALUE_TRAILING_NEWLINE:
        type: string
        description: Trailing newline handling for config values
        default: strip-for-single-line

      DOCKER_IMAGE_NAME:
        type: string
        description: Target image name (from versions-and-naming)
        required: true

      DOCKER_TAG:
        type: string
        description: Target image tag (from versions-and-naming)
        required: true

      VERSION:
        type: string
        description: Version string (from versions-and-naming)
        required: true

      PROJECT_NAME:
        type: string
        description: Project name (from versions-and-naming)
        required: true

      LOG_ERROR_PREFIX:
        type: string
        description: Prefix for error messages
        default: ""

      LOG_ERROR_SUFFIX:
        type: string
        description: Suffix for error messages
        default: ""

      LOG_WARNING_PREFIX:
        type: string
        description: Prefix for warning messages
        default: ""

      LOG_WARNING_SUFFIX:
        type: string
        description: Suffix for warning messages
        default: ""

    outputs:
      DOCKER_TARGET_IMAGE_FULL_URI:
        type: string
        description: Full image reference for push step

      DOCKER_SUBSTITUTED_SUB_PATH:
        type: string
        description: Directory containing substituted files (for downstream use)

    exit_codes:
      "0": Success
      "1": Validation failure (missing Dockerfile, wrong case, image exists, docker issues)
      "42": Infrastructure failure

  docker-build-retag:
    description: |
      Pull an upstream image and retag it for your registry.
      Used for repackaging third-party images.
    inputs:
      DOCKER_SOURCE_REGISTRY:
        type: string
        description: Source container registry hostname
        required: true

      DOCKER_SOURCE_BASE_PATH:
        type: string
        description: Source path between registry and image name
        default: ""

      DOCKER_SOURCE_IMAGE_NAME:
        type: string
        description: Source image name
        required: true

      DOCKER_SOURCE_TAG:
        type: string
        description: Source image tag
        required: true

      DOCKER_TARGET_REGISTRY:
        type: string
        description: Target container registry hostname
        required: true

      DOCKER_TARGET_BASE_PATH:
        type: string
        description: Target path between registry and image name
        default: ""

      DOCKER_IMAGE_NAME:
        type: string
        description: Target image name (from versions-and-naming)
        required: true

      DOCKER_TAG:
        type: string
        description: Target image tag (from versions-and-naming)
        required: true

      LOG_ERROR_PREFIX:
        type: string
        description: Prefix for error messages
        default: ""

      LOG_ERROR_SUFFIX:
        type: string
        description: Suffix for error messages
        default: ""

      LOG_WARNING_PREFIX:
        type: string
        description: Prefix for warning messages
        default: ""

      LOG_WARNING_SUFFIX:
        type: string
        description: Suffix for warning messages
        default: ""

    outputs:
      DOCKER_SOURCE_IMAGE_FULL_URI:
        type: string
        description: Full source image reference

      DOCKER_TARGET_IMAGE_FULL_URI:
        type: string
        description: Full target image reference

    exit_codes:
      "0": Success
      "1": Validation failure (registry format, image exists)
      "42": Infrastructure failure

  docker-push:
    description: |
      Push a Docker image to registry.
      Only pushes on release builds.
    inputs:
      DOCKER_IMAGE_FULL_URI:
        type: string
        description: Full image reference to push
        required: true

      IS_RELEASE:
        type: boolean
        description: Only push if true
        default: false

    outputs:
      IMAGE_PUSHED:
        type: boolean
        description: Whether image was pushed

    exit_codes:
      "0": Success (pushed or skipped)

    notes: |
      Silently skips push when IS_RELEASE is false.
      Designed to be safe to call on all builds.

  docker-registry-logins:
    description: |
      Authenticate to one or more container registries.
      Supports multiple providers via plugin architecture.
    inputs:
      CONFIG:
        type: string
        description: YAML configuration with registry definitions
        required: true

      SECRET_METHOD:
        type: string
        description: Method for retrieving secrets
        required: true
        allowed_values:
          - github
          - env

      SECRETS_JSON:
        type: string
        description: JSON object containing secrets
        default: "{}"

      LOG_ERROR_PREFIX:
        type: string
        description: Prefix for error messages
        default: ""

      LOG_ERROR_SUFFIX:
        type: string
        description: Suffix for error messages
        default: ""

      LOG_GROUP_START:
        type: string
        description: Group start marker (CI integration)
        default: ""

      LOG_GROUP_END:
        type: string
        description: Group end marker (CI integration)
        default: ""

    outputs: {}

    exit_codes:
      "0": Success
      "1": Configuration failure (missing config, invalid method, missing secrets, unknown login type)

    notes: |
      Supported login types:
      - username-password: Basic authentication
      - github-token: GitHub token authentication
      - aws-ecr: AWS ECR with credentials
      - aws-ecr-github-actions-oidc: AWS ECR with OIDC
      - gcp-gar: Google Artifact Registry with service account
      - gcp-gar-github-actions-oidc: GAR with OIDC
      - azure-acr: Azure Container Registry with credentials
      - azure-acr-github-actions-oidc: ACR with OIDC

  kubernetes-manifests-package:
    description: |
      Package Kubernetes manifests into a zip with variable substitution.
      Prepares manifests for deployment by replacing tokens with actual values.
    inputs:
      MANIFESTS_SUB_PATH:
        type: string
        description: Directory containing Kubernetes manifests (relative)
        default: src/kubernetes

      PROJECT_NAME:
        type: string
        description: Project name for variable substitution
        required: true

      VERSION:
        type: string
        description: Version for variable substitution and naming
        required: true

      OUTPUT_SUB_PATH:
        type: string
        description: Build output directory (relative)
        default: target

      DOCKER_TAG:
        type: string
        description: Docker tag for variable substitution (optional)
        default: ""

      DOCKER_IMAGE_NAME:
        type: string
        description: Docker image name for variable substitution (optional)
        default: ""

      DOCKER_IMAGE_FULL_URI:
        type: string
        description: Full Docker image URI for variable substitution (optional)
        default: ""

      TARGET_REGISTRY:
        type: string
        description: Target registry for variable substitution (optional)
        default: ""

      TARGET_BASE_PATH:
        type: string
        description: Target base path for variable substitution (optional)
        default: ""

      IS_RELEASE:
        type: string
        description: Release flag for variable substitution (optional)
        default: ""

      SUBSTITUTION_TOKEN_STYLE:
        type: string
        description: Token delimiter syntax for variables
        default: shell
        allowed_values:
          - shell
          - mustache
          - helm
          - erb
          - github-actions
          - blade
          - stringtemplate
          - ognl
          - t4
          - swift

      TOKEN_NAME_STYLE:
        type: string
        description: Case style for token names in manifests
        default: PascalCase
        allowed_values:
          - PascalCase
          - camelCase
          - lower_snake
          - UPPER_SNAKE
          - lower-kebab
          - UPPER-KEBAB
          - lower.dot
          - UPPER.DOT
          - ALL

      TOKEN_NAME_VALIDATION:
        type: string
        description: How to validate user token names (MATCH = must match token-name-style, ALL = accept any valid name)
        default: MATCH

      ALLOW_BUILTIN_TOKEN_OVERRIDE:
        type: boolean
        description: Allow user tokens to override built-in tokens (for template/reusable projects)
        default: false

      CONFIG_SUB_PATH:
        type: string
        description: Directory containing user-defined token files (relative)
        default: src/config

      CONFIG_VALUE_TRAILING_NEWLINE:
        type: string
        description: How to handle trailing newlines in config values
        default: strip-for-single-line
        allowed_values:
          - strip-for-single-line
          - preserve-all
          - always-strip-one-newline

      LOG_ERROR_PREFIX:
        type: string
        description: Prefix for error messages
        default: ""

      LOG_ERROR_SUFFIX:
        type: string
        description: Suffix for error messages
        default: ""

    outputs:
      MANIFESTS_ZIP_SUB_PATH:
        type: string
        description: Directory containing the zip file (relative)

      MANIFESTS_ZIP_FILE_NAME:
        type: string
        description: Filename of the zip

    exit_codes:
      "0": Success
      "1": Validation or packaging failure

  kubernetes-manifests-repo-provider-package:
    description: |
      Selector script that dispatches to repo provider package plugins.
      Packages manifests for the repo provider (e.g., builds docker image) but does NOT publish.
    inputs:
      MANIFESTS_REPO_PROVIDER_TYPE:
        type: string
        description: Type of repo provider to use
        default: docker

      LOG_ERROR_PREFIX:
        type: string
        description: Prefix for error messages
        default: ""

      LOG_ERROR_SUFFIX:
        type: string
        description: Suffix for error messages
        default: ""

    outputs: {}

    exit_codes:
      "0": Success
      "1": Unknown repo provider type (package script does not exist)
      "2": Repo provider type package script is not executable

    notes: |
      Router script - all other inputs are passed through to the selected plugin.
      Available providers discovered from plugins/kubernetes-manifests-repo-providers/

  kubernetes-manifests-repo-provider-publish:
    description: |
      Selector script that dispatches to repo provider publish plugins.
      Publishes packaged manifests via the repo provider (e.g., pushes docker image).
    inputs:
      MANIFESTS_REPO_PROVIDER_TYPE:
        type: string
        description: Type of repo provider to use
        default: docker

      LOG_ERROR_PREFIX:
        type: string
        description: Prefix for error messages
        default: ""

      LOG_ERROR_SUFFIX:
        type: string
        description: Suffix for error messages
        default: ""

    outputs:
      MANIFESTS_URI:
        type: string
        description: Reference to published manifests (format depends on repo provider)

      MANIFESTS_PUBLISHED:
        type: boolean
        description: Whether manifests were published

    exit_codes:
      "0": Success
      "1": Unknown repo provider type (publish script does not exist)
      "2": Repo provider type publish script is not executable

    notes: |
      Router script - all other inputs are passed through to the selected plugin.
      Available providers discovered from plugins/kubernetes-manifests-repo-providers/

  spec-package-prepare:
    description: Prepare spec files for packaging into OCI image
    inputs:
      PROJECT_NAME:
        type: string
        description: Project name (used to find ${PROJECT_NAME}.yaml)
        required: true
      VERSION:
        type: string
        description: Version string for output filenames
        required: true
      OUTPUT_SUB_PATH:
        type: string
        description: Base directory for output files
        required: true
      SPEC_PACKAGING_BASE_IMAGE:
        type: string
        description: Base image for generated Dockerfile
        default: scratch
    outputs:
      SPEC_SUB_PATH:
        type: string
        description: Directory containing spec files (relative)
      SPEC_YAML:
        type: string
        description: Filename of versioned YAML spec
      SPEC_JSON:
        type: string
        description: Filename of versioned JSON spec
      DOCKERFILE_SUB_PATH:
        type: string
        description: Directory containing generated Dockerfile
    exit_codes:
      "0": Success
      "1": Spec file not found
    notes: |
      Copies spec YAML, converts to JSON, generates Dockerfile.
      Token substitution handled by docker build step.

  spec-validate:
    description: Validate spec file against its JSON schema
    inputs:
      SPEC_TYPE:
        type: string
        description: Type of spec being validated
        required: true
        allowed_values:
          - schema
          - api
      SPEC_SUB_PATH:
        type: string
        description: Directory containing spec files (relative)
        required: true
      SPEC_JSON:
        type: string
        description: Filename of spec JSON file
        required: true
      SPEC_VALIDATION_TYPE:
        type: string
        description: Validation method to use
        default: basic
        allowed_values:
          - basic
          - python3-jsonschema
    outputs: {}
    exit_codes:
      "0": Validation passed
      "1": Validation failed (missing file, invalid type, schema mismatch)
    notes: |
      Run after docker build has performed token substitution.
      For api specs, reads $schema from the spec file.
      For schema specs, validates against JSON Schema draft-07.

internals:
  docker-build-shared:
    description: Shared functions for docker build scripts
    called_by:
      - docker-build-dockerfile
      - docker-build-retag
    inputs:
      DOCKER_TARGET_REGISTRY:
        type: string
        description: Target registry hostname
        required: true

      DOCKER_TARGET_BASE_PATH:
        type: string
        description: Target base path
        default: ""

      DOCKER_IMAGE_NAME:
        type: string
        description: Image name
        required: true

      DOCKER_TAG:
        type: string
        description: Image tag
        required: true

    outputs:
      DOCKER_TARGET_IMAGE_FULL_URI:
        type: string
        description: Assembled full image URI

    notes: |
      Sourced by docker build scripts, not executed directly.
      Provides: confirm_target_image_doesnt_exist(), output_var()

  version-sort:
    description: Sort version strings semantically
    called_by:
      - versions-and-naming
    inputs:
      VERSIONS:
        type: array
        description: Versions to sort (one per line on stdin)

    outputs:
      sorted:
        type: string
        description: Sorted versions, one per line
        stdout: true

  prepare-substitution-tokens:
    description: Prepare token values for substitution
    called_by:
      - docker-build-dockerfile
      - kubernetes-manifests-package

  substitute-tokens-from-dir:
    description: Perform token substitution on files
    called_by:
      - docker-build-dockerfile
      - kubernetes-manifests-package

  format-project-title:
    description: Format lower-kebab style project name into display title
    inputs:
      PROJECT_NAME:
        type: string
        description: Project name in lower-kebab naming style (e.g., kaptain-build-scripts)
        kind: positional
        position: 1
        required: true
    outputs:
      TITLE:
        type: string
        description: Formatted title (e.g., Kaptain Build Scripts)
        stdout: true
    notes: |
      Handles special words: API, GitHub, AWS, GCP, CLI, JSON, YAML, etc.
      Used for display purposes. For example in platform specific GitHub release titles.

deprecations:
  BLOCK_SLASHES:
    replaced_by: BLOCK_SLASH_CONTAINING_BRANCHES
    added_in_version: "0.0"
    deprecated_in_version: "0.1"
    notes: Renamed for clarity. Both names currently work.
